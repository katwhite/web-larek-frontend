# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка товара

```
export interface IProduct {
    _id: string;
    title: string;
    description: string;
    category: string;
    price: number;
    image: string;
}
```

Модель для хранения каталога карточек

```
export interface ICardsData {
	cards: IProduct[];
	preview: string | null;
	addCard(card: IProduct): void;
	deleteCard(cardId: string, payload: Function | null): void;
	getCard(cardId: string): IProduct;
	checkValidation(data: Record<keyof TCardInfo, string>): boolean;
}
```

Модель для хранения списка покупок в корзине
```
export interface IBasket {
    items: Map<string, number>;
    add(id: string): void;
    remove(id: string): void;
}
```

Данные карточки, отображаемые в корзине

```
export type IBasketItem = Pick<ICard, '_id' | 'title' | 'price'>;
```

Формы заказа получают следующие данные
```
export interface IOrderForm {
    email: string;
    phone: string;
    address: string;
    payment: 'Онлайн' | 'При получении';
    checkValidation(data: Record<keyof IOrderForm, string>): boolean;
}
```

Данные, которые нужно отобразить при успешном заказе
```
export interface IOrderResult {
    price: number;
}
```

## Архитектура приложения

Код разделён на слои согласно парадигме MVP:
- слой представления - отвечает за отображение данных
- слой данных - отвечает за хранение и изменение данных
- презентер - связавает представление и данные

## Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
Методы:
- `get` - выполняет СЕТ запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JЅОN в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `РОЅT` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. 
Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `оn` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс LarekApi

Расширяет Api. В конструктор добавляется базовый url для загрузки контента.\
Методы:
- `getProductItem`(id: string): Promise<IProduct> - 
- `getProductList`(): Promise<IProduct[]> - возвращает промис с массивом всех товаров
- `orderProducts`(order: IOrder): Promise<IOrderResult> - отправляет заказ на сервер

#### Класс CardsData

Отвечает за хранение и обновление данных карточек\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся:
- _cards: IProduct[] - массив объектов карточек
- _preview: string | null - айди карточки, выбранной для просмотра в модалке
- events: IEvents - экземпляр EventEmitter'а для работы с событиями

Методы для взаимодействия с данными:
сеттер и геттер массива карточек и превью
- getCard(cardId: string): ICard; - возвращает карточку по её айди

#### Класс Basket

Отвечает за хранение списка покупок.\
Конструктор принимает DOM элемент списка по селектору - cейчас это `.basket__list`\
Поля класса:
- items: Map<string, number>; - массив объектов карточек
- basketPrice: number - общая стоимость

Есть геттер и сеттер общей стоимости и следующие методы:
- add(id: string): void; - добавляет товар в корзину
- remove(id: string): void; - удаляет товар из корзины

### Слой представления

#### Абстракстный класс Component

Отвечает за отображение базового компонента, в конструктор принимает селектор контейнера.\
Имеет методы для работы с HTML:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - убирает или добавляет класс элементу
- setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое элемента
- setDisabled(element: HTMLElement, state: boolean) - блокирует и разблокирует элемент
- setHidden(element: HTMLElement) - скрывает элемент
- setVisible(element: HTMLElement) - показывает элемент
- setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение
- render - возвращает корневой дом элемент

#### Класс Page

Расширяет Component. Принимает контейнер и брокер событий в конструктор. Имеет поля:
- _counter: HTMLElement; - счётчик покупок
- _catalog: HTMLElement;
- _wrapper: HTMLElement;
- _basket: HTMLElement;

Имеет сеттер счётчика, каталога, и блокировки страницы (boolean) при открытии модального окна

#### Класс Card

Расширяет Component. Отвечает за отображение одной карточки. В конструктор передаётся брокер событий и темплейт.\
Поля:
- id
- title
- price

Методы:
- setData(cardData: ICard): void - заполняет темплейт данными
- render(): HTMLElement - отрисовывает разметку карточки

геттер id возвращает id карточки

#### Класс CardCatalog

Расширяет Card. Устанавливается слушатель клика на карточку для открытия модального окна\
Добавляются поля:
- category
- image

#### Класс CardPreview

Расширяет CardCatalog. Добавляется поле `description`.

#### Класс CardContainer

Расширяет Component. Отвечает за отрисовку каталога карточек. В конструктор передаётся контейнер gallery, в котором размещаются карточки\
Имеет сеттер container и метод `addCard` для добавления карточки в каталог

#### Класс BasketItemView

Расширяет Component. Отвечает за отрисовку элемента корзины. Принимает в конструктор селектор и брокер событий. Имеет метод `render`, отрисовывающий карточку по айди

#### Класс BasketView

Расширяет Component. Отвечает за отрисовку всей корзины. В конструктор принимает контейнер, а в метод `render` - список товаров

#### Класс Modal

Расширяет Component. Отвечает за отображение модального окна, имеет слушатели для закрытия на клавиатуре на Esc, на оверлее по клику, и на кнопке крестика по клику
Конструктор принимает селектор с айди из темплейта и брокер событий

Имеет поля:
- modal: HTMLElement - элемент модального окна
- events: IEvents - события
- button: HTMLButtonElement | null - элемент кнопки, на которую будем вешать слушатели; в макете у всех модалок есть кнопка, но в будущем может появиться окно без неё

Методы:
- open(): void
- close(): void

#### Класс ModalWithCard

Расширяет класс Modal. Реализует модальное окно с полным отображением карточки.\
Содержит поля:
- card: ICard - отображаемая карточка - нужно брать темплейт card-preview

Методы:
- open(id: string) - для открытия модального окна с карточкой по айди

#### Класс ModalWithForm

Расширяет класс Modal. Реализует модальное окно с формой.\
Содержит поля:
- errors: Record<string, HTMLElement> - элементы для отображения ошибок валидации, привязан к name инпутов
- inputs: NodeListOf<HTMLInputElement> - коллекция полей ввода 

Методы:
- setValid(): boolean - делает кнопку активной или неактивной
- getInputValues(): Record<string, string> - возвращает объект с данными из полей ввода формы. Ключ - name инпута, значение - введённые данные
- setInputValues(data: Record<string, string>): void - позволяет заполинть поля принятыми данными; в макете такого нет, но пригодится при расширении проекта
- setError(data: {field: string, value: string, validInformation: string}): void - принимает объект с сообщениями об ошибках и нужными полями
- showInputError(field: string, errorMessage: string): void - отображает нужное сообщение об ошибке под выбранным полем
- hideInputError(field: string): void - убирает сообщение об ошибке под выбранным полем

#### Класс Form

Расширяет Component. Отвечает за отображение элементов формы\
Конструктор принимает контейнер и инстант брокера событий\
В полях класса хранятся:
- button: HTMLButtonElement - кнопка перехода на следующее окно
- errors: HTMLElement - элемент для вывода ошибок валидации

Метод для проверки корректности введённых данных:
- checkValidation(data: Record<keyof IOrderForm, string>): boolean;
- onInputChange(field: keyof T, value: string)

#### Класс Order

Расширяет Form. Имеет сеттеры email, phone, address, payment.

#### Класс ModalWithConfirm

Расширяет класс Modal. Реализует модальное окно с подтверждением заказа.\
Содержит поля:
- price: number - общая цена

#### Класс ModalWithBasket

Расширяет класс Modal. Реализует модальное окно с корзиной.\
Содержит поля:
- cardItem: IBasketItem - берёт темплейт card-basket

### Слой коммуникации

`index.ts` выполняет роль презентера. В нём создаются экземпляры классов, затем настраивается обработка событий\
#### *Список возможных событий:*
*События изменения данных:*
- `cards:changed` - изменение списка карточек
- `card:selected` - выбор карточки
- `card:added` - добавление карточки в корзину (изменяется кнопка на отображении карточки и список покупок)
- `card:deleted` - удаление карточки из корзины

*События взаимодействия с интерфейсом:*
- `card:open` - открытие модального окна с карточкой
- `basket:open` - открытие модального окна с корзиной
- `addressForm:open` - открытие модального окна с формой адреса при нажатии кнопки "оформить"
- `addressForm:submit` - открытие модального окна с формой средств связи при нажатии кнопки "далее"
- `phoneForm:submit` - отправка формы и открытие модального окна с подтверждением заказа при нажатии кнопки "оплатить"
- `modal:close` - событие при нажатии кнопки "за новыми покупками"
- `card:delete` - выбор карточки для удаления
- `card:select` - выбор карточки для открытия в модальном окне
- `addressForm:input` - изменение данных в форме адреса
- `phoneForm:input` - изменение данных в форме средств связи
- `addressForm:validation` - событие, говорящее о необходимости валидации формы адреса
- `phoneForm:validation` - событие, говорящее о необходимости валидации формы средств связи
